<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Ordinary Least Squares, continued</title>
    <meta charset="utf-8" />
    <meta name="author" content="Max Czapanskiy" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/plotly-binding/plotly.js"></script>
    <script src="libs/typedarray/typedarray.min.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="my-css.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Ordinary Least Squares, continued
]
.subtitle[
## EDS 222
]
.author[
### Max Czapanskiy
]
.date[
### Fall 2024
]

---



name: Overview

# Today

#### Notes on OLS
- Outliers, missing data

--

#### Measures of model fit
- Coefficient of variation `\(R^2\)`

--

#### Categorical variables
- In .mono[R], interpretation

--

#### Multiple linear regression
- Adding independent variables, interpretation of results

---

layout: false
class: clear, middle, inverse
# Notes on OLS

---

# Outliers

Because OLS minimizes the sum of the **squared** errors, outliers can play a large role in our estimates.

**Common responses**

- Remove the outliers from the dataset

- Replace outliers with the 99&lt;sup&gt;th&lt;/sup&gt; percentile of their variable (*winsorize*)

- Take the log of the variable (This lowers the leverage of large values -- why?)

- Do nothing. Outliers are not always bad. Some people are "far" from the average. It may not make sense to try to change this variation.

---

# Missing data

Similarly, missing data can affect your results.

.mono[R] doesn't know how to deal with a missing observation.

```r
1 + 2 + 3 + NA + 5
```

```
#&gt; [1] NA
```

If you run a regression&lt;sup&gt;â€ &lt;/sup&gt; with missing values, .mono[R] drops the observations missing those values.

If the observations are missing in a nonrandom way, a random sample may end up nonrandom.

.footnote[
[â€ ]: Or perform almost any operation/function
]

---

layout: false
class: clear, middle, inverse
# Measures of model fit

---

# Measures of model fit

### Goal: quantify how "well" your regression model fits the data

#### General idea: Larger variance in residuals suggests our model isn't very predictive

.pull-left[

&lt;img src="week3-slides_files/figure-html/highvar-1.svg" style="display: block; margin: auto;" /&gt;

]

--

.pull-right[

&lt;img src="week3-slides_files/figure-html/lowvar-1.svg" style="display: block; margin: auto;" /&gt;

]

---

# Coefficient of determination

- We already learned one measure of the strength of a linear relationship: correlation, `\(r\)`

--

- In OLS, we often rely on `\(R^2\)`, the **coefficient of determination**. In simple linear regression, this is simply the square of the correlation.
- Interpretation of `\(R^2\)`: **share of the variance in `\(y\)` that is explained by your regression model**

--
$$
SSR = \text{sum of squared residuals} = \sum_i (y_i - \hat y_i)^2 = \sum_i e_i^2 
$$

$$
SST = \text{total sum of squares} = \sum_i (y_i - \bar y)^2 
$$

$$
R^2 = 1 - \frac{SSR}{SST} = 1 - \frac{\sum_i e_i^2}{\sum_i (y_i - \bar y)^2}
$$


---

# Coefficient of determination

$$
R^2 = 1 - \frac{SSR}{SST} = 1 - \frac{\sum_i e_i^2}{\sum_i (y_i - \bar y)^2}
$$
--

- `\(R^2\)` varies between 0 and 1: Perfect model with `\(e_i=0\)` for all `\(i\)` has `\(R^2=1\)`. `\(R^2=0\)` if we just guess the mean `\(\bar y\)`.

--

- In more complex models, `\(R^2\)` is not the same as the square of the correlation coefficient. You should think of them as related but distinct concepts.

---

# Coefficient of determination

About 49% of the variation in ozone can be explained with temperature alone!

&lt;img src="ozone_temp_r2.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# Coefficient of determination

#### Definition: % of variance in `\(y\)` that is explained by `\(x\)` (and any other independent variables)

--

- Describes a _linear_ relationship between `\(y\)` and `\(\hat y\)`
 
--

- Higher `\(R^2\)` does not mean a model is "better" or more appropriate
  + Predictive power is not often the goal of regression analysis (e.g., you may just care about getting `\(\beta_1\)` right)
  + If you are focused on predictive power, many other measures of fit can be appropriate (to discuss in machine learning)
  + Always look at your data and residuals! 
  
--

- Like OLS in general, `\(R^2\)` is very sensitive to outliers. Again...always look at your data!

---

# Coefficient of determination 

Here, `\(R^2=0.94\)` for a model of `\(y = \beta_0 + \beta_1 x + \epsilon\)`. Does that mean a linear relationship with `\(x\)` is appropriate?


&lt;img src="week3-slides_files/figure-html/rsq-1.svg" style="display: block; margin: auto;" /&gt;

---

# Coefficient of determination 

Here, `\(R^2=0\)` for a model of `\(y = \beta_0 + \beta_1 x + \epsilon\)`. Does that mean there is no relationship between these variables?


&lt;img src="week3-slides_files/figure-html/rsq2-1.svg" style="display: block; margin: auto;" /&gt;

---

layout: false
class: clear, middle, inverse
# Indicator/categorical variables

---

# Categorical variables

We have been talking a lot about **numerical** variables in linear regression...
  + Ozone levels
  + Crab size
  + Temperature and precipitation amounts
  + etc.

--

...but a lot of variables of interest are **categorical**:
  + Male/female
  + Presence/absence of a species
  + In/out of compliance with a pollution standard
  + etc.

--

#### How do we execute and interpret linear regression with categorical data?

---

# Categorical variables

We use **dummy** or **indicator** variables in linear regression to capture the influence of a categorical independent variable (_x_) on a continuous dependent variable (_y_).

--

For example, let _x_ be a categorical variable indicating the gender of an individual. Suppose we are interested in the "gender wage gap", so _y_ is income We estimate:

$$y_i = \beta_0 + \beta_1 MALE_i + \varepsilon_i $$
--

###Interpretation [draw it]:
- `\(MALE_i\)` is an **indicator** variable that = 1 when `\(i\)` is male (0 otherwise)
- `\(\beta_0=\)` average wages if `\(i\)` is **not** male
- `\(\beta_0+\beta_1=\)` average wages if `\(i\)` is male
- `\(\beta_1=\)` average _difference_ in wages between males and females

---

# Categorical variables

#### For a categorical variable with two "levels", the OLS slope coefficient is the _difference_ in means across the two groups

&lt;img src="week3-slides_files/figure-html/unnamed-chunk-2-1.svg" style="display: block; margin: auto;" /&gt;

---

# Categorical variables

#### What if I have many categories?
- E.g., species, education level, age group, ...

For example, let _x_ be a categorical variable indicating the species of penguin, and _y_ is body mass. We estimate:

$$y_i = \beta_0 + \beta_1 SPECIES_i + \varepsilon_i $$
Where **species** can be one of:
- Adelie
- Chinstrap
- Gentoo

---

# Categorical variables


```r
library(palmerpenguins) 
head(penguins)
```

```
#&gt; # A tibble: 6 Ã— 8
#&gt;   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
#&gt;   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
#&gt; 1 Adelie  Torgersen           39.1          18.7               181        3750
#&gt; 2 Adelie  Torgersen           39.5          17.4               186        3800
#&gt; 3 Adelie  Torgersen           40.3          18                 195        3250
#&gt; 4 Adelie  Torgersen           NA            NA                  NA          NA
#&gt; 5 Adelie  Torgersen           36.7          19.3               193        3450
#&gt; 6 Adelie  Torgersen           39.3          20.6               190        3650
#&gt; # â„¹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;
```

```r
class(penguins$species)
```

```
#&gt; [1] "factor"
```

---

# Categorical variables


```r
summary(lm(body_mass_g ~ species, data = penguins))
```

```
#&gt; 
#&gt; Call:
#&gt; lm(formula = body_mass_g ~ species, data = penguins)
#&gt; 
#&gt; Residuals:
#&gt;      Min       1Q   Median       3Q      Max 
#&gt; -1126.02  -333.09   -33.09   316.91  1223.98 
#&gt; 
#&gt; Coefficients:
#&gt;                  Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)       3700.66      37.62   98.37   &lt;2e-16 ***
#&gt; speciesChinstrap    32.43      67.51    0.48    0.631    
#&gt; speciesGentoo     1375.35      56.15   24.50   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 462.3 on 339 degrees of freedom
#&gt;   (2 observations deleted due to missingness)
#&gt; Multiple R-squared:  0.6697,	Adjusted R-squared:  0.6677 
#&gt; F-statistic: 343.6 on 2 and 339 DF,  p-value: &lt; 2.2e-16
```

---

# Categorical variables

What is going on here?? One _x_ variable turned into multiple slope coefficients? ðŸ¤”

--

.mono[R] is turning our regression

$$y_i = \beta_0 + \beta_1 SPECIES_i + \varepsilon_i $$

where _SPECIES_ is a categorical variable indicating one of three species, into:

$$y_i = \beta_0 + \beta_1 CHINSTRAP_i +\beta_2 GENTOO_i + \varepsilon_i $$

where _CHINSTRAP_ and _GENTOO_ are dummy variables for the Chinstrap and Gentoo species, respectively.

---

# Categorical variables

When your categorical variable takes on `\(k\)` values, .mono[R] will create dummy variables for `\(k-1\)` values, leaving one as the **reference** group:

&lt;img src="penguins.png" width="1087" style="display: block; margin: auto;" /&gt;

--

To evaluate the outcome for the reference group, **set the dummy variables equal to zero for all other groups**.

&gt; Q: What is the average body mass of an Adelie species?

&gt; Q: What is the difference in body mass between Chinstrap and Adelie?


---

layout: false
class: clear, middle, inverse
# Multiple linear regression

---

# More explanatory variables

We're moving from **simple linear regression** (one .pink[outcome variable] and one .purple[explanatory variable])

$$ \color{#e64173}{y_i} = \beta_0 + \beta_1 \color{#6A5ACD}{x_i} + u_i $$

--

to the land of **multiple linear regression** (one .pink[outcome variable] and multiple .purple[explanatory variables])

$$ \color{#e64173}{y\_i} = \beta\_0 + \beta\_1 \color{#6A5ACD}{x\_{1i}} + \beta\_2 \color{#6A5ACD}{x\_{2i}} + \cdots + \beta\_k \color{#6A5ACD}{x\_{ki}} + u\_i $$

--

**Why?**
--
 We can better explain the variation in `\(y\)`, improve predictions, avoid omitted-variable bias (i.e., second assumption needed for unbiased OLS estimates), ...

---

# More explanatory variables

Multiple linear regression...

$$ \color{#e64173}{y\_i} = \beta\_0 + \beta\_1 \color{#6A5ACD}{x\_{1i}} + \beta\_2 \color{#6A5ACD}{x\_{2i}} + \cdots + \beta\_k \color{#6A5ACD}{x\_{ki}} + u\_i $$
--

... raises many questions:

--

- Which `\(x\)`'s should I include? This is the problem of "model selection".

--

- How does my interpretation of `\(\beta_1\)` change?

--

- What if my `\(x\)`'s interact with each other? E.g., race and gender, temperature and rainfall.

--

- How do I measure model fit now?

--

**We will dig into each of these here,** and you will see these questions in other MEDS courses

---

# Multiple regression



`\(y_i = \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i} + u_i \quad\)` `\(x_1\)` is continuous `\(\quad x_2\)` is categorical

--

&lt;img src="week3-slides_files/figure-html/multregplot1-1.svg" style="display: block; margin: auto;" /&gt;



---

# Multiple regression

The intercept and categorical variable `\(x_2\)` control for the groups' means.

&lt;img src="week3-slides_files/figure-html/multregplot2-1.svg" style="display: block; margin: auto;" /&gt;

---

# Multiple regression


`\(\hat{\beta}_1\)` estimates the relationship between `\(y\)` and `\(x_1\)` after controlling for `\(x_2\)`. This is often called the "parallel slopes" model (one slope `\(\beta_1\)` for each of the groups in `\(x_2\)`)

&lt;img src="week3-slides_files/figure-html/multregplot5-1.svg" style="display: block; margin: auto;" /&gt;


---

# Multiple regression

More generally, how do we think about multiple explanatory variables?

--

Suppose `\(y_i = \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i} + u_i\)`



.pull-left[

&lt;img src="week3-slides_files/figure-html/yx1-1.svg" style="display: block; margin: auto;" /&gt;

]

--

.pull-right[

&lt;img src="week3-slides_files/figure-html/yx2-1.svg" style="display: block; margin: auto;" /&gt;

]

---

# Multiple regression

More generally, how do we think about multiple explanatory variables?

<div class="plotly html-widget html-fill-item" id="htmlwidget-ada8cc9ad64e1dba5279" style="width:756px;height:504px;"></div>
<script type="application/json" data-for="htmlwidget-ada8cc9ad64e1dba5279">{"x":{"visdat":{"16cf57d5013e1":["function () ","plotlyVisDat"]},"cur_data":"16cf57d5013e1","attrs":{"16cf57d5013e1":{"x":[-2.3177795321680605,0.73379642888903618,0.65564839728176594,0.74027665005996823,2.1654923013411462,0.84186363173648715,-2.9430254618637264,-1.6046969639137387,0.99650254938751459,0.085506848059594631,1.1615477507002652,0.2698490135371685,-1.3035984984599054,2.5406009056605399,-1.2461049584671855,2.0237737689167261,-1.2826602919958532,-1.3990753199905157,-1.8796632620505989,-1.6066445368342102,-1.1003252710215747,-1.183839775621891,-2.0457239826209843,-2.7600244916975498,-1.6872027539648116,1.8635913147591054,0.15418528066948056,2.4879489960148931,1.9880702812224627,-2.7253784202039242,-0.26345110544934869,-1.408879968803376,-1.1719667818397284,0.043841220438480377,-1.9134227503091097,1.5580238127149642,-1.7925117742270231,-1.4471410880796611,2.9529025051742792,1.8441140418872237,0.32000154443085194,0.87843656446784735,-1.1290541575290263,0.73091518878936768,-1.0213789455592632,0.011984837707132101,1.0625671637244523,-0.090052565094083548,-1.5364270359277725,1.5927587253972888,-2.5573207195848227,-1.1418803888373077,1.3036304600536823,0.02727547287940979,-2.082006246317178,0.023600928951054811,-0.036234461702406406,1.5072011821903288,-1.9521010564640164,2.0903544626198709,2.1890029921196401,-2.7488563489168882,-1.0969070680439472,-2.9175003650598228,-1.5658456399105489,1.2389677036553621,-1.1514314571395516,0.051285394001752138,-2.6901202839799225,0.3874190398491919,-2.2711188769899309,2.3570182900875807,-2.9122364656068385,1.6987266219221056,-2.4602320021949708,0.11513988487422466,-0.6943998746573925,-2.5796850160695612,-1.0761334667913616,1.0109723825007677,2.5584028582088649,-0.16854167310521007,-2.1443079407326877,0.26561853010207415,-1.8229520888999104,2.3914829352870584,-0.66300129191949964,-1.1347753219306469,-2.0398280220106244,2.3771150973625481,-2.0016373177058995,2.4025475769303739,-2.1955308294855058,-2.2103151949122548,-2.3682749848812819,0.069501486606895924,-1.1988056763075292,-2.8396986275911331,-1.1421154118143022,1.4527179426513612],"y":[5.3545672702603042,10.650761120487005,7.8025777614675462,7.041963164228946,6.3373889867216349,8.25681924354285,6.5506196953356266,6.2996213953010738,9.3553105974569917,5.3864265256561339,12.133015629369766,6.0076904110610485,14.50304938480258,6.2181776273064315,7.1965662087313831,14.130877668503672,14.458531211130321,7.7915622293949127,6.2347108777612448,12.971604594495147,12.442772150970995,14.159742237534374,14.945982450153679,14.423607150092721,9.8613540758378804,7.8345954278483987,7.5154570117592812,10.032551707699895,9.9696617317385972,8.184458096511662,14.622228268999606,11.340993682388216,6.2743339804001153,9.2304699379019439,14.143169096205384,9.6779233333654702,14.081691454630345,10.977432837244123,11.317428159527481,13.691583187319338,10.027498225681484,14.836351147387177,8.2438602740876377,9.8137494851835072,8.5698707750998437,11.27477684058249,12.416001905221492,10.659668173175305,14.807865065522492,10.768127355258912,9.3904205178841949,7.2859969502314925,5.8215806563384831,13.502649217844009,7.3466126155108213,14.881674468051642,11.01897545857355,14.987408081069589,8.7559937662445009,10.551266309339553,9.2944396287202835,10.758777807932347,9.3250739737413824,7.2484576399438083,5.8498473768122494,11.372982596512884,9.310163704212755,5.7271609362214804,13.024020192679018,8.2527830335311592,12.572890350129455,10.842715173494071,12.088394067250192,9.2697576642967761,8.4357270202599466,12.591199851594865,9.2403020802885294,10.608872538432479,6.1613577441312373,8.0302179767750204,9.788026858586818,8.4483054676093161,11.007141401059926,5.7608332321979105,14.559926111251116,5.222068231087178,13.417106324341148,11.324424487538636,8.1009416515007615,12.425693662371486,11.389113136101514,14.925159872509539,6.2826978834345937,13.832395777571946,13.100833878852427,13.218511783052236,13.347026624251157,12.327322205528617,14.830440243240446,11.392045826651156],"z":[23.150572147584263,40.394529579529625,29.62065614229288,25.925098224461948,21.358065058416059,31.352402622187896,27.249239616961475,25.971367932773791,35.779708101455306,20.408094137693809,46.174580148062546,22.111842879101264,57.20602880627149,22.181383806220243,29.054732319468741,54.330877522404798,56.872497285172912,31.734350651336342,26.491673080043256,52.466786538366271,49.680021706349535,56.040902079059514,62.88781577099919,60.204954545224261,41.956827359694621,28.554850037726478,28.27623346740128,35.128969714750959,36.254476814646871,34.689512338747733,58.766054528913521,46.025604833422584,24.097354390599069,36.54675285969433,55.835998200286284,35.787817272555017,56.803159263915326,42.408626389734785,42.236867655326549,51.299347112511256,38.455954708297625,58.862115917610481,33.74116966491853,37.415651054954282,34.814624824363314,44.486394331896783,49.264296904591923,42.004618661380789,60.274159921225426,40.827302670662171,38.741765143625287,29.383487652872514,22.621436810421979,52.107728924307061,30.59021670700151,59.865227604100497,42.877515209073898,56.389048334144938,35.106292515806111,38.724583745091287,33.141405449631925,44.523328188546877,36.982783256667581,30.728280127115621,24.372291245040124,43.877595810598322,39.07029201769528,21.788664697319177,53.465361142037814,33.094718811324348,53.267009675334847,40.057086441446231,49.93315541547409,32.558068617701906,36.614402481981536,48.412077087428372,35.531845401416192,47.058941055894763,24.95658575156698,30.076640914486006,32.861485053182605,32.861972955100576,46.148905279894784,22.191583314140665,59.974978695514487,19.48052218974604,54.500535103297722,44.923736256669969,34.147774806479184,46.127243278301322,46.02001907322709,53.442333258088546,25.536675510960119,57.027712940363728,55.939643039810321,52.305240259882837,54.207122376979477,50.183084239572025,59.626531092894353,41.037227822065887],"mode":"markers","color":[23.150572147584263,40.394529579529625,29.62065614229288,25.925098224461948,21.358065058416059,31.352402622187896,27.249239616961475,25.971367932773791,35.779708101455306,20.408094137693809,46.174580148062546,22.111842879101264,57.20602880627149,22.181383806220243,29.054732319468741,54.330877522404798,56.872497285172912,31.734350651336342,26.491673080043256,52.466786538366271,49.680021706349535,56.040902079059514,62.88781577099919,60.204954545224261,41.956827359694621,28.554850037726478,28.27623346740128,35.128969714750959,36.254476814646871,34.689512338747733,58.766054528913521,46.025604833422584,24.097354390599069,36.54675285969433,55.835998200286284,35.787817272555017,56.803159263915326,42.408626389734785,42.236867655326549,51.299347112511256,38.455954708297625,58.862115917610481,33.74116966491853,37.415651054954282,34.814624824363314,44.486394331896783,49.264296904591923,42.004618661380789,60.274159921225426,40.827302670662171,38.741765143625287,29.383487652872514,22.621436810421979,52.107728924307061,30.59021670700151,59.865227604100497,42.877515209073898,56.389048334144938,35.106292515806111,38.724583745091287,33.141405449631925,44.523328188546877,36.982783256667581,30.728280127115621,24.372291245040124,43.877595810598322,39.07029201769528,21.788664697319177,53.465361142037814,33.094718811324348,53.267009675334847,40.057086441446231,49.93315541547409,32.558068617701906,36.614402481981536,48.412077087428372,35.531845401416192,47.058941055894763,24.95658575156698,30.076640914486006,32.861485053182605,32.861972955100576,46.148905279894784,22.191583314140665,59.974978695514487,19.48052218974604,54.500535103297722,44.923736256669969,34.147774806479184,46.127243278301322,46.02001907322709,53.442333258088546,25.536675510960119,57.027712940363728,55.939643039810321,52.305240259882837,54.207122376979477,50.183084239572025,59.626531092894353,41.037227822065887],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"x1"},"yaxis":{"title":"x2"},"zaxis":{"title":"y"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-2.3177795321680605,0.73379642888903618,0.65564839728176594,0.74027665005996823,2.1654923013411462,0.84186363173648715,-2.9430254618637264,-1.6046969639137387,0.99650254938751459,0.085506848059594631,1.1615477507002652,0.2698490135371685,-1.3035984984599054,2.5406009056605399,-1.2461049584671855,2.0237737689167261,-1.2826602919958532,-1.3990753199905157,-1.8796632620505989,-1.6066445368342102,-1.1003252710215747,-1.183839775621891,-2.0457239826209843,-2.7600244916975498,-1.6872027539648116,1.8635913147591054,0.15418528066948056,2.4879489960148931,1.9880702812224627,-2.7253784202039242,-0.26345110544934869,-1.408879968803376,-1.1719667818397284,0.043841220438480377,-1.9134227503091097,1.5580238127149642,-1.7925117742270231,-1.4471410880796611,2.9529025051742792,1.8441140418872237,0.32000154443085194,0.87843656446784735,-1.1290541575290263,0.73091518878936768,-1.0213789455592632,0.011984837707132101,1.0625671637244523,-0.090052565094083548,-1.5364270359277725,1.5927587253972888,-2.5573207195848227,-1.1418803888373077,1.3036304600536823,0.02727547287940979,-2.082006246317178,0.023600928951054811,-0.036234461702406406,1.5072011821903288,-1.9521010564640164,2.0903544626198709,2.1890029921196401,-2.7488563489168882,-1.0969070680439472,-2.9175003650598228,-1.5658456399105489,1.2389677036553621,-1.1514314571395516,0.051285394001752138,-2.6901202839799225,0.3874190398491919,-2.2711188769899309,2.3570182900875807,-2.9122364656068385,1.6987266219221056,-2.4602320021949708,0.11513988487422466,-0.6943998746573925,-2.5796850160695612,-1.0761334667913616,1.0109723825007677,2.5584028582088649,-0.16854167310521007,-2.1443079407326877,0.26561853010207415,-1.8229520888999104,2.3914829352870584,-0.66300129191949964,-1.1347753219306469,-2.0398280220106244,2.3771150973625481,-2.0016373177058995,2.4025475769303739,-2.1955308294855058,-2.2103151949122548,-2.3682749848812819,0.069501486606895924,-1.1988056763075292,-2.8396986275911331,-1.1421154118143022,1.4527179426513612],"y":[5.3545672702603042,10.650761120487005,7.8025777614675462,7.041963164228946,6.3373889867216349,8.25681924354285,6.5506196953356266,6.2996213953010738,9.3553105974569917,5.3864265256561339,12.133015629369766,6.0076904110610485,14.50304938480258,6.2181776273064315,7.1965662087313831,14.130877668503672,14.458531211130321,7.7915622293949127,6.2347108777612448,12.971604594495147,12.442772150970995,14.159742237534374,14.945982450153679,14.423607150092721,9.8613540758378804,7.8345954278483987,7.5154570117592812,10.032551707699895,9.9696617317385972,8.184458096511662,14.622228268999606,11.340993682388216,6.2743339804001153,9.2304699379019439,14.143169096205384,9.6779233333654702,14.081691454630345,10.977432837244123,11.317428159527481,13.691583187319338,10.027498225681484,14.836351147387177,8.2438602740876377,9.8137494851835072,8.5698707750998437,11.27477684058249,12.416001905221492,10.659668173175305,14.807865065522492,10.768127355258912,9.3904205178841949,7.2859969502314925,5.8215806563384831,13.502649217844009,7.3466126155108213,14.881674468051642,11.01897545857355,14.987408081069589,8.7559937662445009,10.551266309339553,9.2944396287202835,10.758777807932347,9.3250739737413824,7.2484576399438083,5.8498473768122494,11.372982596512884,9.310163704212755,5.7271609362214804,13.024020192679018,8.2527830335311592,12.572890350129455,10.842715173494071,12.088394067250192,9.2697576642967761,8.4357270202599466,12.591199851594865,9.2403020802885294,10.608872538432479,6.1613577441312373,8.0302179767750204,9.788026858586818,8.4483054676093161,11.007141401059926,5.7608332321979105,14.559926111251116,5.222068231087178,13.417106324341148,11.324424487538636,8.1009416515007615,12.425693662371486,11.389113136101514,14.925159872509539,6.2826978834345937,13.832395777571946,13.100833878852427,13.218511783052236,13.347026624251157,12.327322205528617,14.830440243240446,11.392045826651156],"z":[23.150572147584263,40.394529579529625,29.62065614229288,25.925098224461948,21.358065058416059,31.352402622187896,27.249239616961475,25.971367932773791,35.779708101455306,20.408094137693809,46.174580148062546,22.111842879101264,57.20602880627149,22.181383806220243,29.054732319468741,54.330877522404798,56.872497285172912,31.734350651336342,26.491673080043256,52.466786538366271,49.680021706349535,56.040902079059514,62.88781577099919,60.204954545224261,41.956827359694621,28.554850037726478,28.27623346740128,35.128969714750959,36.254476814646871,34.689512338747733,58.766054528913521,46.025604833422584,24.097354390599069,36.54675285969433,55.835998200286284,35.787817272555017,56.803159263915326,42.408626389734785,42.236867655326549,51.299347112511256,38.455954708297625,58.862115917610481,33.74116966491853,37.415651054954282,34.814624824363314,44.486394331896783,49.264296904591923,42.004618661380789,60.274159921225426,40.827302670662171,38.741765143625287,29.383487652872514,22.621436810421979,52.107728924307061,30.59021670700151,59.865227604100497,42.877515209073898,56.389048334144938,35.106292515806111,38.724583745091287,33.141405449631925,44.523328188546877,36.982783256667581,30.728280127115621,24.372291245040124,43.877595810598322,39.07029201769528,21.788664697319177,53.465361142037814,33.094718811324348,53.267009675334847,40.057086441446231,49.93315541547409,32.558068617701906,36.614402481981536,48.412077087428372,35.531845401416192,47.058941055894763,24.95658575156698,30.076640914486006,32.861485053182605,32.861972955100576,46.148905279894784,22.191583314140665,59.974978695514487,19.48052218974604,54.500535103297722,44.923736256669969,34.147774806479184,46.127243278301322,46.02001907322709,53.442333258088546,25.536675510960119,57.027712940363728,55.939643039810321,52.305240259882837,54.207122376979477,50.183084239572025,59.626531092894353,41.037227822065887],"mode":"markers","type":"scatter3d","marker":{"colorbar":{"title":"","ticklen":2},"cmin":19.48052218974604,"cmax":62.88781577099919,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[23.150572147584263,40.394529579529625,29.62065614229288,25.925098224461948,21.358065058416059,31.352402622187896,27.249239616961475,25.971367932773791,35.779708101455306,20.408094137693809,46.174580148062546,22.111842879101264,57.20602880627149,22.181383806220243,29.054732319468741,54.330877522404798,56.872497285172912,31.734350651336342,26.491673080043256,52.466786538366271,49.680021706349535,56.040902079059514,62.88781577099919,60.204954545224261,41.956827359694621,28.554850037726478,28.27623346740128,35.128969714750959,36.254476814646871,34.689512338747733,58.766054528913521,46.025604833422584,24.097354390599069,36.54675285969433,55.835998200286284,35.787817272555017,56.803159263915326,42.408626389734785,42.236867655326549,51.299347112511256,38.455954708297625,58.862115917610481,33.74116966491853,37.415651054954282,34.814624824363314,44.486394331896783,49.264296904591923,42.004618661380789,60.274159921225426,40.827302670662171,38.741765143625287,29.383487652872514,22.621436810421979,52.107728924307061,30.59021670700151,59.865227604100497,42.877515209073898,56.389048334144938,35.106292515806111,38.724583745091287,33.141405449631925,44.523328188546877,36.982783256667581,30.728280127115621,24.372291245040124,43.877595810598322,39.07029201769528,21.788664697319177,53.465361142037814,33.094718811324348,53.267009675334847,40.057086441446231,49.93315541547409,32.558068617701906,36.614402481981536,48.412077087428372,35.531845401416192,47.058941055894763,24.95658575156698,30.076640914486006,32.861485053182605,32.861972955100576,46.148905279894784,22.191583314140665,59.974978695514487,19.48052218974604,54.500535103297722,44.923736256669969,34.147774806479184,46.127243278301322,46.02001907322709,53.442333258088546,25.536675510960119,57.027712940363728,55.939643039810321,52.305240259882837,54.207122376979477,50.183084239572025,59.626531092894353,41.037227822065887],"line":{"colorbar":{"title":"","ticklen":2},"cmin":19.48052218974604,"cmax":62.88781577099919,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[23.150572147584263,40.394529579529625,29.62065614229288,25.925098224461948,21.358065058416059,31.352402622187896,27.249239616961475,25.971367932773791,35.779708101455306,20.408094137693809,46.174580148062546,22.111842879101264,57.20602880627149,22.181383806220243,29.054732319468741,54.330877522404798,56.872497285172912,31.734350651336342,26.491673080043256,52.466786538366271,49.680021706349535,56.040902079059514,62.88781577099919,60.204954545224261,41.956827359694621,28.554850037726478,28.27623346740128,35.128969714750959,36.254476814646871,34.689512338747733,58.766054528913521,46.025604833422584,24.097354390599069,36.54675285969433,55.835998200286284,35.787817272555017,56.803159263915326,42.408626389734785,42.236867655326549,51.299347112511256,38.455954708297625,58.862115917610481,33.74116966491853,37.415651054954282,34.814624824363314,44.486394331896783,49.264296904591923,42.004618661380789,60.274159921225426,40.827302670662171,38.741765143625287,29.383487652872514,22.621436810421979,52.107728924307061,30.59021670700151,59.865227604100497,42.877515209073898,56.389048334144938,35.106292515806111,38.724583745091287,33.141405449631925,44.523328188546877,36.982783256667581,30.728280127115621,24.372291245040124,43.877595810598322,39.07029201769528,21.788664697319177,53.465361142037814,33.094718811324348,53.267009675334847,40.057086441446231,49.93315541547409,32.558068617701906,36.614402481981536,48.412077087428372,35.531845401416192,47.058941055894763,24.95658575156698,30.076640914486006,32.861485053182605,32.861972955100576,46.148905279894784,22.191583314140665,59.974978695514487,19.48052218974604,54.500535103297722,44.923736256669969,34.147774806479184,46.127243278301322,46.02001907322709,53.442333258088546,25.536675510960119,57.027712940363728,55.939643039810321,52.305240259882837,54.207122376979477,50.183084239572025,59.626531092894353,41.037227822065887]}},"frame":null},{"x":[-2.9430254618637264,2.9529025051742792],"y":[5.222068231087178,14.987408081069589],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":19.48052218974604,"cmax":62.88781577099919,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[19.48052218974604,62.88781577099919],"line":{"color":"rgba(255,127,14,1)"}},"z":[19.48052218974604,62.88781577099919],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

---

# Multiple regression

### With **many** explanatory variables, we visualizing relationships means thinking about **hyperplanes** ðŸ¤¯

`$$y_i = \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i} + ... + \beta_k x_{ki} + u_i$$`
#### Math notation looks very similar to simple linear regression, but _conceptually_ and _visually_ multiple regression is **very different**

---

# Multiple regression

### Interpretation of coefficients

`$$y_i = \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i} + ... + \beta_k x_{ki} + u_i$$`

--

- `\(\beta_k\)` tells us the change in `\(y\)` due to a one unit change in `\(x_k\)` when **all other variables are held constant**

--

- This is an "all else equal" interpretation

--

- E.g., how much do wages increase with one more year of education, _holding gender fixed_? 

--

- E.g., how much does ozone increase when temperature rises, _holding NOx emissions fixed_? 

---

# Tradeoffs

There are tradeoffs to consider as we add/remove variables:

**Fewer variables**

- Generally explain less variation in `\(y\)`
- Provide simple interpretations and visualizations (*parsimonious*)
- May need to worry about omitted-variable bias

**More variables**

- More likely to find *spurious* relationships (statistically significant due to chanceâ€”does not reflect a true, population-level relationship)
- More difficult to interpret the model
- You may still miss important variablesâ€”still omitted-variable bias

---

# Omitted-variable bias

You will study this in much more depth in EDS 241, but here's a primer.

**Omitted-variable bias** (OVB) arises when we omit a variable that

1. affects our outcome variable `\(y\)`

2. correlates with an explanatory variable `\(x_j\)`

As it's name suggests, this situation leads to bias in our estimate of `\(\beta_j\)`. In particular, it violates Assumption 2 of OLS from last week. 

--

**Note:** OVB Is not exclusive to multiple linear regression, but it does require multiple variables affect `\(y\)`.

---

# Omitted-variable bias

**Example**

Let's imagine a simple model for the cancer rates in census tract `\(i\)`:

$$ \text{Cancer rate}_i = \beta_0 + \beta_1 \text{UV radiation}_i + \beta_2 \text{TRI}_i + u_i $$

where

- `\(\text{UV radiation}_i\)` gives the average UV radiation in tract `\(i\)` (mW/cm$^2$) 
- `\(\text{TRI}_i\)` denotes an indicator variable for whether tract `\(i\)` has a Toxics Release Inventory facility 

thus

- `\(\beta_1\)`: the change in cancer rate associated with a 1 mW/cm$^2$ increase in UV radiation (*ceteris paribus*)
- `\(\beta_2\)`: the difference in avg. cancer rates between TRI and non-TRI census tracts (*ceteris paribus*)
&lt;br&gt;If `\(\beta_2 &gt; 0\)`, then TRI tracts have higher cancer rates

---

# Omitted-variable bias





**"True" relationship:** `\(\text{Cancer rate}_i = 20 + 0.5 \times \text{UV radiation}_i + 10 \times \text{TRI}_i + u_i\)`

The relationship between cancer rates and UV radiations:

&lt;img src="week3-slides_files/figure-html/plotovb1-1.svg" style="display: block; margin: auto;" /&gt;

---

# Omitted-variable bias

Biased regression estimate: `\(\widehat{\text{Cancer rate}}_i = 31.3 + -0.9 \times \text{UV radiation}_i\)`

&lt;img src="week3-slides_files/figure-html/plotovb2-1.svg" style="display: block; margin: auto;" /&gt;

---

# Omitted-variable bias

Recalling the omitted variable: TRI (**&lt;font color="#e64173"&gt;non-TRI&lt;/font&gt;** and **&lt;font color="#314f4f"&gt;TRI&lt;/font&gt;**)

&lt;img src="week3-slides_files/figure-html/plotovb3-1.svg" style="display: block; margin: auto;" /&gt;

---

# Omitted-variable bias

Recalling the omitted variable: TRI (**&lt;font color="#e64173"&gt;non-TRI&lt;/font&gt;** and **&lt;font color="#314f4f"&gt;TRI&lt;/font&gt;**)

&lt;img src="week3-slides_files/figure-html/plotovb4-1.svg" style="display: block; margin: auto;" /&gt;

---

# Omitted-variable bias

Unbiased regression estimate: `\(\widehat{\text{Cancer rate}}_i = 20.9 + 0.4 \times \text{UV radiation}_i + 9.1 \times \text{TRI}_i\)`

&lt;img src="week3-slides_files/figure-html/plotovb5-1.svg" style="display: block; margin: auto;" /&gt;

---

class: center, middle


Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).

Some slide components come from [Ed Rubin's](https://github.com/edrubin/EC421S20) awesome course materials.


&lt;style type="text/css"&gt;
@media print {
  .has-continuation {
    display: block;
  }
}
&lt;/style&gt;
  
---
exclude: true




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
